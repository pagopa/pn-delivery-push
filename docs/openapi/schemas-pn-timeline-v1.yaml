
components:
  schemas:
    TimelineElementId:
      type: string
    
    TimelineElementCategory:
      type: string
      enum:
        - REQUEST_ACCEPTED
        - SEND_COURTESY_MESSAGE
        - NOTIFICATION_PATH_CHOOSE
        - GET_ADDRESS
        - PUBLIC_REGISTRY_CALL
        - PUBLIC_REGISTRY_RESPONSE
        - SCHEDULE_ANALOG_WORKFLOW
        - SCHEDULE_DIGITAL_WORKFLOW
        - SEND_DIGITAL_DOMICILE
        - SEND_DIGITAL_DOMICILE_FEEDBACK
        - SEND_DIGITAL_FEEDBACK
        - SEND_DIGITAL_DOMICILE_FAILURE
        - REFINEMENT
        - SCHEDULE_REFINEMENT
        - DIGITAL_SUCCESS_WORKFLOW
        - DIGITAL_FAILURE_WORKFLOW
        - ANALOG_SUCCESS_WORKFLOW
        - ANALOG_FAILURE_WORKFLOW
        - SEND_SIMPLE_REGISTERED_LETTER
        - END_OF_DIGITAL_DELIVERY_WORKFLOW
        - END_OF_ANALOG_DELIVERY_WORKFLOW
        - NOTIFICATION_VIEWED
        - SEND_ANALOG_DOMICILE
        - SEND_PAPER_FEEDBACK
        - PAYMENT
        - COMPLETELY_UNREACHABLE
        - REQUEST_REFUSED
    
    DownstreamId:
      description: identificativo del messaggio nel sistema a valle
      type: object
      properties:
        systemId:
          type: string
          description: Identificativo del sistema a valle di inoltro messaggistica
        messageId:
          type: string
          description: Identificativo del messaggio inoltrato
    
    TimelineElement:
      type: object
      properties:
        elementId:
          type: string
          description: >-
            Identificativo dell'elemento di timeline: insieme allo IUN della notifica definisce in 
            maniera univoca l'elemento di timeline
        timestamp:
          type: string
          description: Momento in cui avviene l'evento desritto in questo elemento
            di timeline
          format: date-time
        legalFactsIds:
          type: array
          items:
            $ref: "./schemas-pn-legal-facts-v1.yaml#/components/schemas/LegalFactsId"
          description: >-
            Chiavi dei documenti che provano l'effettivo accadimento dell'evento descritto in timeline.
            Questo elemento
        category:
          $ref: '#/components/schemas/TimelineElementCategory'
        details:
          oneOf:
            - "$ref": "#/components/schemas/AnalogFailureWorkflow"
            - "$ref": "#/components/schemas/AnalogSuccessWorkflow"
            - "$ref": "#/components/schemas/CompletelyUnreachableDetails"
            - "$ref": "#/components/schemas/DigitalFailureWorkflow"
            - "$ref": "#/components/schemas/DigitalSuccessWorkflow"
            - "$ref": "#/components/schemas/EndOfAnalogDeliveryWorkflowDetails"
            - "$ref": "#/components/schemas/EndOfDigitalDeliveryWorkflowDetails"
            - "$ref": "#/components/schemas/GetAddressInfo"
            - "$ref": "#/components/schemas/NotificationPathChooseDetails"
            - "$ref": "#/components/schemas/NotificationViewedDetails"
            - "$ref": "#/components/schemas/PublicRegistryCallDetails"
            - "$ref": "#/components/schemas/PublicRegistryResponseDetails"
            - "$ref": "#/components/schemas/RefinementDetails"
            - "$ref": "#/components/schemas/RequestRefusedDetails"
            - "$ref": "#/components/schemas/ScheduleAnalogWorkflow"
            - "$ref": "#/components/schemas/ScheduleDigitalWorkflow"
            - "$ref": "#/components/schemas/ScheduleRefinement"
            - "$ref": "#/components/schemas/SendCourtesyMessageDetails"
            - "$ref": "#/components/schemas/SendDigitalDetails"
            - "$ref": "#/components/schemas/SendDigitalFailureDetails"
            - "$ref": "#/components/schemas/SendDigitalFeedback"
            - "$ref": "#/components/schemas/SendDigitalFeedbackDetails"
            - "$ref": "#/components/schemas/SendPaperDetails"
            - "$ref": "#/components/schemas/SendPaperFeedbackDetails"
            - "$ref": "#/components/schemas/SimpleRegisteredLetterDetails"

    AnalogFailureWorkflow:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    AnalogSuccessWorkflow:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
    DigitalFailureWorkflow:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    DigitalSuccessWorkflow:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
    CompletelyUnreachableDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    EndOfAnalogDeliveryWorkflowDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    EndOfDigitalDeliveryWorkflowDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    GetAddressInfo:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        source:
          type: string
          description: Sorgente indirizzo
          enum:
          - PLATFORM
          - SPECIAL
          - GENERAL
        isAvailable:
          type: boolean
          description: Disponibilità indirizzo
        attemptDate:
          type: string
          description: Data tentativo
          format: date-time
        available:
          type: boolean
    NotificationPathChooseDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice fiscale destinatario
        deliveryMode:
          type: string
          description: >-
            Specifica se la notifica al destinatario segue il percorso
            analogico o quello digitale
          enum:
          - DIGITAL
          - ANALOG
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        platform:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        special:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        general:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        courtesyAddresses:
          type: array
          description: Elenco recapiti digitali del destinatario
          items:
            $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
    NotificationViewedDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    PublicRegistryCallDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        deliveryMode:
          type: string
          description: Tipologia Domiciliazione
          enum:
          - DIGITAL
          - ANALOG
        contactPhase:
          type: string
          description: Fase in cui è avvenuta la richiesta
          enum:
          - CHOOSE_DELIVERY
          - SEND_ATTEMPT
        sentAttemptMade:
          type: integer
          description: Numero di tentativi di notificazione già effettuati
          format: int32
        sendDate:
          type: string
          description: Data invio richiesta ai public registry
          format: date-time
    PublicRegistryResponseDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
    RefinementDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    RequestRefusedDetails:
      type: object
      properties:
        errors:
          type: array
          description: Motivazioni che hanno portato al rifiuto della notifica
          items:
            type: string
            description: Motivazioni che hanno portato al rifiuto della notifica
    ScheduleAnalogWorkflow:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    ScheduleDigitalWorkflow:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    ScheduleRefinement:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    SendCourtesyMessageDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        sendDate:
          type: string
          description: data invio messaggio di cortesia
          format: date-time
    SendDigitalDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        addressSource:
          type: string
          description: sorgente indirizzo di invio della notifica
          enum:
          - PLATFORM
          - SPECIAL
          - GENERAL
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        downstreamId:
          "$ref": "#/components/schemas/DownstreamId"
    SendDigitalFailureDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    SendDigitalFeedback:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        responseStatus:
          type: string
          description: stato risposta ricevuta da externalChannel
          enum:
          - OK
          - KO
        notificationDate:
          type: string
          description: data notifica
          format: date-time
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
    SendDigitalFeedbackDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        addressSource:
          type: string
          description: sorgente indirizzo di invio della notifica
          enum:
          - PLATFORM
          - SPECIAL
          - GENERAL
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        downstreamId:
          "$ref": "#/components/schemas/DownstreamId"
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
    SendPaperDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        serviceLevel:
          type: string
          description: Livello Servizio
          enum:
          - SIMPLE_REGISTERED_LETTER
          - REGISTERED_LETTER_890
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        investigation:
          type: boolean
          description: E' richiesta investigazione indirizzo fisico alternativo
    SendPaperFeedbackDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        serviceLevel:
          type: string
          description: Livello Servizio
          enum:
          - SIMPLE_REGISTERED_LETTER
          - REGISTERED_LETTER_890
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        investigation:
          type: boolean
          description: E' richiesta investigazione indirizzo fisico alternativo
        newAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
    SimpleRegisteredLetterDetails:
      type: object
      properties:
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"

    




