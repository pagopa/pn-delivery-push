
components:
  schemas:
    TimelineElementId:
      type: string
    
    TimelineElementCategory:
      type: string
      enum:
        - REQUEST_ACCEPTED
        - SEND_COURTESY_MESSAGE
        - GET_ADDRESS
        - PUBLIC_REGISTRY_CALL
        - PUBLIC_REGISTRY_RESPONSE
        - SCHEDULE_ANALOG_WORKFLOW
        - SCHEDULE_DIGITAL_WORKFLOW
        - SEND_DIGITAL_DOMICILE
        - SEND_DIGITAL_DOMICILE_FEEDBACK
        - SEND_DIGITAL_FEEDBACK
        - REFINEMENT
        - SCHEDULE_REFINEMENT
        - DIGITAL_SUCCESS_WORKFLOW
        - DIGITAL_FAILURE_WORKFLOW
        - ANALOG_SUCCESS_WORKFLOW
        - ANALOG_FAILURE_WORKFLOW
        - SEND_SIMPLE_REGISTERED_LETTER
        - NOTIFICATION_VIEWED
        - SEND_ANALOG_DOMICILE
        - SEND_PAPER_FEEDBACK
        - PAYMENT
        - COMPLETELY_UNREACHABLE
        - REQUEST_REFUSED
        - AAR_GENERATION

    
    DownstreamId:
      description: identificativo del messaggio nel sistema a valle
      type: object
      properties:
        systemId:
          type: string
          description: Identificativo del sistema a valle di inoltro messaggistica
        messageId:
          type: string
          description: Identificativo del messaggio inoltrato
    
    TimelineElement:
      type: object
      additionalProperties: false
      properties:
        elementId:
          type: string
          description: >-
            Identificativo dell'elemento di timeline: insieme allo IUN della notifica definisce in 
            maniera univoca l'elemento di timeline
        timestamp:
          type: string
          description: Momento in cui avviene l'evento desritto in questo elemento
            di timeline
          format: date-time
        legalFactsIds:
          type: array
          items:
            $ref: "./schemas-pn-legal-facts-v1.yaml#/components/schemas/LegalFactsId"
          description: >-
            Chiavi dei documenti che provano l'effettivo accadimento dell'evento descritto in timeline.
            Questo elemento
        category:
          $ref: '#/components/schemas/TimelineElementCategory'
        details:
          $ref: '#/components/schemas/TimelineElementDetails'

    TimelineElementDetails:
      description: The raw event payload that will be different based on the event.
      oneOf:
        - "$ref": "#/components/schemas/NotificationRequestAccepted"
        - "$ref": "#/components/schemas/AnalogFailureWorkflow"
        - "$ref": "#/components/schemas/AnalogSuccessWorkflow"
        - "$ref": "#/components/schemas/CompletelyUnreachableDetails"
        - "$ref": "#/components/schemas/DigitalFailureWorkflow"
        - "$ref": "#/components/schemas/DigitalSuccessWorkflow"
        - "$ref": "#/components/schemas/GetAddressInfo"
        - "$ref": "#/components/schemas/NotificationViewedDetails"
        - "$ref": "#/components/schemas/PublicRegistryCallDetails"
        - "$ref": "#/components/schemas/PublicRegistryResponseDetails"
        - "$ref": "#/components/schemas/RefinementDetails"
        - "$ref": "#/components/schemas/RequestRefusedDetails"
        - "$ref": "#/components/schemas/ScheduleAnalogWorkflow"
        - "$ref": "#/components/schemas/ScheduleDigitalWorkflow"
        - "$ref": "#/components/schemas/ScheduleRefinement"
        - "$ref": "#/components/schemas/SendCourtesyMessageDetails"
        - "$ref": "#/components/schemas/SendDigitalDetails"
        - "$ref": "#/components/schemas/SendDigitalFeedback"
        - "$ref": "#/components/schemas/SendPaperDetails"
        - "$ref": "#/components/schemas/SendPaperFeedbackDetails"
        - "$ref": "#/components/schemas/SimpleRegisteredLetterDetails"
        - "$ref": "#/components/schemas/AarGenerationDetails"


    NotificationRequestAccepted:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    AnalogFailureWorkflow:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    AnalogSuccessWorkflow:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
          
    DigitalFailureWorkflow:
      type: object
      properties:
        recIndex: 
          type: integer
          description: Index destinatario notifica digitale
          
    DigitalSuccessWorkflow:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
          
    CompletelyUnreachableDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    GetAddressInfo: 
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        isAvailable:
          type: boolean
          description: Disponibilità indirizzo
        attemptDate:
          type: string
          description: Data tentativo
          format: date-time

    NotificationViewedDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    PublicRegistryCallDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        deliveryMode:
          $ref: '#/components/schemas/DeliveryMode'
        contactPhase:
          $ref: '#/components/schemas/ContactPhase'
        sentAttemptMade:
          type: integer
          description: Numero di tentativi di notificazione già effettuati
        sendDate:
          type: string
          description: Data invio richiesta ai public registry
          format: date-time
          
    PublicRegistryResponseDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
          
    RefinementDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    RequestRefusedDetails:
      type: object
      properties:
        errors:
          type: array
          description: Motivazioni che hanno portato al rifiuto della notifica
          items:
            type: string
            description: Motivazioni che hanno portato al rifiuto della notifica
            
    ScheduleAnalogWorkflow:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    ScheduleDigitalWorkflow:
      type: object
      properties:
        recIndex:
          type: integer
          description: Informazioni ultimo tentativo effettuato
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        sentAttemptMade:
          type: integer
        lastAttemptDate:
          type: string
          format: date-time
            
    ScheduleRefinement:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          
    SendCourtesyMessageDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        sendDate:
          type: string
          description: data invio messaggio di cortesia
          format: date-time
          
    SendDigitalDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        downstreamId:
          "$ref": "#/components/schemas/DownstreamId"
          
    SendDigitalFeedback:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        responseStatus:
          $ref: '#/components/schemas/ResponseStatus'
        notificationDate:
          type: string
          description: data notifica
          format: date-time
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
            
    SendPaperDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        serviceLevel:
          "$ref": "#/components/schemas/ServiceLevel"
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
        investigation:
          type: boolean
          description: E' richiesta investigazione indirizzo fisico alternativo
          
    SendPaperFeedbackDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        serviceLevel:
          "$ref": "#/components/schemas/ServiceLevel"
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
        investigation:
          type: boolean
          description: E' richiesta investigazione indirizzo fisico alternativo
        newAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
            
    SimpleRegisteredLetterDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"

    AarGenerationDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        safestorageKey:
          type: string
          description: Chiave per recupero da safestorage

    DigitalAddressSource:
      type: string
      description: sorgente indirizzo di invio della notifica
      enum:
        - PLATFORM
        - SPECIAL
        - GENERAL

    ServiceLevel:
      type: string
      description: Livello Servizio
      enum:
        - SIMPLE_REGISTERED_LETTER
        - REGISTERED_LETTER_890
          
    ResponseStatus:
      type: string
      description: stato risposta ricevuta da externalChannel
      enum:
        - OK
        - KO
    
    ContactPhase:
      type: string
      description: Fase in cui è avvenuta la richiesta
      enum:
        - CHOOSE_DELIVERY
        - SEND_ATTEMPT

    DeliveryMode:
      type: string
      description: Tipologia Domiciliazione
      enum:
        - DIGITAL
        - ANALOG