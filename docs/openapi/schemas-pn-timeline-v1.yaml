
components:
  schemas:
    TimelineElementId:
      type: string
    
    TimelineElementCategory:
      type: string
      enum:
        - REQUEST_ACCEPTED
        - SEND_COURTESY_MESSAGE
        - NOTIFICATION_PATH_CHOOSE
        - GET_ADDRESS
        - PUBLIC_REGISTRY_CALL
        - PUBLIC_REGISTRY_RESPONSE
        - SCHEDULE_ANALOG_WORKFLOW
        - SCHEDULE_DIGITAL_WORKFLOW
        - SEND_DIGITAL_DOMICILE
        - SEND_DIGITAL_DOMICILE_FEEDBACK
        - SEND_DIGITAL_FEEDBACK
        - SEND_DIGITAL_DOMICILE_FAILURE
        - REFINEMENT
        - SCHEDULE_REFINEMENT
        - DIGITAL_SUCCESS_WORKFLOW
        - DIGITAL_FAILURE_WORKFLOW
        - ANALOG_SUCCESS_WORKFLOW
        - ANALOG_FAILURE_WORKFLOW
        - SEND_SIMPLE_REGISTERED_LETTER
        - END_OF_DIGITAL_DELIVERY_WORKFLOW
        - END_OF_ANALOG_DELIVERY_WORKFLOW
        - NOTIFICATION_VIEWED
        - SEND_ANALOG_DOMICILE
        - SEND_PAPER_FEEDBACK
        - PAYMENT
        - COMPLETELY_UNREACHABLE
        - REQUEST_REFUSED
    
    DownstreamId:
      description: identificativo del messaggio nel sistema a valle
      type: object
      properties:
        systemId:
          type: string
          description: Identificativo del sistema a valle di inoltro messaggistica
        messageId:
          type: string
          description: Identificativo del messaggio inoltrato
    
    TimelineElement:
      type: object
      additionalProperties: false
      properties:
        elementId:
          type: string
          description: >-
            Identificativo dell'elemento di timeline: insieme allo IUN della notifica definisce in 
            maniera univoca l'elemento di timeline
        timestamp:
          type: string
          description: Momento in cui avviene l'evento desritto in questo elemento
            di timeline
          format: date-time
        legalFactsIds:
          type: array
          items:
            $ref: "./schemas-pn-legal-facts-v1.yaml#/components/schemas/LegalFactsId"
          description: >-
            Chiavi dei documenti che provano l'effettivo accadimento dell'evento descritto in timeline.
            Questo elemento
        category:
          $ref: '#/components/schemas/TimelineElementCategory'
        details:
          $ref: '#/components/schemas/TimelineElementDetails'

    TimelineElementDetails:
      description: The raw event payload that will be different based on the event.
      discriminator:
        propertyName: kind
        mapping:
          AnalogFailureWorkflow: "#/components/schemas/AnalogFailureWorkflow"
          AnalogSuccessWorkflow: "#/components/schemas/AnalogSuccessWorkflow"
          CompletelyUnreachableDetails: "#/components/schemas/CompletelyUnreachableDetails"
          DigitalFailureWorkflow: "#/components/schemas/DigitalFailureWorkflow"
          DigitalSuccessWorkflow: "#/components/schemas/DigitalSuccessWorkflow"
          EndOfAnalogDeliveryWorkflowDetails: "#/components/schemas/EndOfAnalogDeliveryWorkflowDetails"
          EndOfDigitalDeliveryWorkflowDetails: "#/components/schemas/EndOfDigitalDeliveryWorkflowDetails"
          GetAddressInfo: "#/components/schemas/GetAddressInfo"
          NotificationPathChooseDetails: "#/components/schemas/NotificationPathChooseDetails"
          NotificationViewedDetails: "#/components/schemas/NotificationViewedDetails"
          PublicRegistryCallDetails: "#/components/schemas/PublicRegistryCallDetails"
          PublicRegistryResponseDetails: "#/components/schemas/PublicRegistryResponseDetails"
          RefinementDetails: "#/components/schemas/RefinementDetails"
          RequestRefusedDetails: "#/components/schemas/RequestRefusedDetails"
          ScheduleAnalogWorkflow: "#/components/schemas/ScheduleAnalogWorkflow"
          ScheduleDigitalWorkflow: "#/components/schemas/ScheduleDigitalWorkflow"
          ScheduleRefinement: "#/components/schemas/ScheduleRefinement"
          SendCourtesyMessageDetails: "#/components/schemas/SendCourtesyMessageDetails"
          SendDigitalDetails: "#/components/schemas/SendDigitalDetails"
          SendDigitalFailureDetails: "#/components/schemas/SendDigitalFailureDetails"
          SendDigitalFeedback: "#/components/schemas/SendDigitalFeedback"
          SendDigitalFeedbackDetails: "#/components/schemas/SendDigitalFeedbackDetails"
          SendPaperDetails: "#/components/schemas/SendPaperDetails"
          SendPaperFeedbackDetails: "#/components/schemas/SendPaperFeedbackDetails"
          SimpleRegisteredLetterDetails: "#/components/schemas/SimpleRegisteredLetterDetails"
      oneOf:
        - "$ref": "#/components/schemas/AnalogFailureWorkflow"
        - "$ref": "#/components/schemas/AnalogSuccessWorkflow"
        - "$ref": "#/components/schemas/CompletelyUnreachableDetails"
        - "$ref": "#/components/schemas/DigitalFailureWorkflow"
        - "$ref": "#/components/schemas/DigitalSuccessWorkflow"
        - "$ref": "#/components/schemas/EndOfAnalogDeliveryWorkflowDetails"
        - "$ref": "#/components/schemas/EndOfDigitalDeliveryWorkflowDetails"
        - "$ref": "#/components/schemas/GetAddressInfo"
        - "$ref": "#/components/schemas/NotificationPathChooseDetails"
        - "$ref": "#/components/schemas/NotificationViewedDetails"
        - "$ref": "#/components/schemas/PublicRegistryCallDetails"
        - "$ref": "#/components/schemas/PublicRegistryResponseDetails"
        - "$ref": "#/components/schemas/RefinementDetails"
        - "$ref": "#/components/schemas/RequestRefusedDetails"
        - "$ref": "#/components/schemas/ScheduleAnalogWorkflow"
        - "$ref": "#/components/schemas/ScheduleDigitalWorkflow"
        - "$ref": "#/components/schemas/ScheduleRefinement"
        - "$ref": "#/components/schemas/SendCourtesyMessageDetails"
        - "$ref": "#/components/schemas/SendDigitalDetails"
        - "$ref": "#/components/schemas/SendDigitalFailureDetails"
        - "$ref": "#/components/schemas/SendDigitalFeedback"
        - "$ref": "#/components/schemas/SendDigitalFeedbackDetails"
        - "$ref": "#/components/schemas/SendPaperDetails"
        - "$ref": "#/components/schemas/SendPaperFeedbackDetails"
        - "$ref": "#/components/schemas/SimpleRegisteredLetterDetails"
          
    AnalogFailureWorkflow:
      type: object
      properties:
        kind:
          type: string
          default: "AnalogFailureWorkflow"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
    AnalogSuccessWorkflow:
      type: object
      properties:
        kind:
          type: string
          default: "AnalogSuccessWorkflow"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
    DigitalFailureWorkflow:
      type: object
      properties:
        kind:
          type: string
          default: "DigitalFailureWorkflow"
        recIndex: 
          type: integer
          description: Index destinatario notifica digitale
    DigitalSuccessWorkflow:
      type: object
      properties:
        kind:
          type: string
          default: "DigitalSuccessWorkflow"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
    CompletelyUnreachableDetails:
      type: object
      properties:
        kind:
          type: string
          default: "CompletelyUnreachableDetails"
        taxId: #TODO Da eliminare quando si passa alla v2
          type: string
          description: Codice Fiscale destinatario notifica digitale
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
    EndOfAnalogDeliveryWorkflowDetails: #TODO Da eliminare quando si passa alla v2
      type: object
      properties:
        kind:
          type: string
          default: "EndOfAnalogDeliveryWorkflowDetails"
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    EndOfDigitalDeliveryWorkflowDetails: #TODO Da eliminare quando si passa alla v2
      type: object
      properties:
        kind:
          type: string
          default: "EndOfDigitalDeliveryWorkflowDetails"
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    GetAddressInfo: 
      type: object
      properties:
        kind:
          type: string
          default: "GetAddressInfo"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        source:
          $ref: '#/components/schemas/DigitalAddressSource'
        isAvailable:
          type: boolean
          description: Disponibilità indirizzo
        attemptDate:
          type: string
          description: Data tentativo
          format: date-time
        available:
          type: boolean
    NotificationPathChooseDetails: #TODO Da eliminare quando si passa alla v2
      type: object
      properties:
        kind:
          type: string
          default: "NotificationPathChooseDetails"
        taxId:
          type: string
          description: Codice fiscale destinatario
        deliveryMode:
          $ref: '#/components/schemas/DeliveryMode'
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        platform:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        special:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        general:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        courtesyAddresses:
          type: array
          description: Elenco recapiti digitali del destinatario
          items:
            $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
    NotificationViewedDetails:
      type: object
      properties:
        kind:
          type: string
          default: "NotificationViewedDetails"
        taxId: #TODO Da eliminare quando si passa alla v2
          type: string
          description: Codice Fiscale destinatario notifica digitale
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
    PublicRegistryCallDetails:
      type: object
      properties:
        kind:
          type: string
          default: "PublicRegistryCallDetails"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        deliveryMode:
          $ref: '#/components/schemas/DeliveryMode'
        contactPhase:
          $ref: '#/components/schemas/ContactPhase'
        sentAttemptMade:
          type: integer
          description: Numero di tentativi di notificazione già effettuati
          format: int32
        sendDate:
          type: string
          description: Data invio richiesta ai public registry
          format: date-time
    PublicRegistryResponseDetails:
      type: object
      properties:
        kind:
          type: string
          default: "PublicRegistryResponseDetails"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        digitalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        physicalAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
    RefinementDetails:
      type: object
      properties:
        kind:
          type: string
          default: "RefinementDetails"
        taxId: #TODO Da eliminare quando si passa alla v2
          type: string
          description: Codice Fiscale destinatario notifica digitale
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
    RequestRefusedDetails:
      type: object
      properties:
        kind:
          type: string
          default: "RequestRefusedDetails"
        errors:
          type: array
          description: Motivazioni che hanno portato al rifiuto della notifica
          items:
            type: string
            description: Motivazioni che hanno portato al rifiuto della notifica
    ScheduleAnalogWorkflow:
      type: object
      properties:
        kind:
          type: string
          default: "ScheduleAnalogWorkflow"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
    ScheduleDigitalWorkflow:
      type: object
      properties:
        kind:
          type: string
          default: "ScheduleDigitalWorkflow"
        recIndex:
          type: integer
          description: Informazioni ultimo tentativo effettuato
        lastAttemptInfo:
          $ref: '#/components/schemas/DigitalAddressInfo'
    ScheduleRefinement:
      type: object
      properties:
        kind:
          type: string
          default: "ScheduleRefinement"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
    SendCourtesyMessageDetails:
      type: object
      properties:
        kind:
          type: string
          default: "SendCourtesyMessageDetails"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        sendDate:
          type: string
          description: data invio messaggio di cortesia
          format: date-time
    SendDigitalDetails:
      type: object
      properties:
        kind:
          type: string
          default: "SendDigitalDetails"
        taxId: #TODO Da eliminare quando si passa alla v2
          type: string
          description: Codice Fiscale destinatario notifica digitale
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        addressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        downstreamId:
          "$ref": "#/components/schemas/DownstreamId"
    SendDigitalFailureDetails: #TODO Da eliminare quando si passa alla v2
      type: object
      properties:
        kind:
          type: string
          default: "SendDigitalFailureDetails"
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
    SendDigitalFeedback:
      type: object
      properties:
        kind:
          type: string
          default: "SendDigitalFeedback"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        responseStatus:
          $ref: '#/components/schemas/ResponseStatus'
        notificationDate:
          type: string
          description: data notifica
          format: date-time
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
    SendDigitalFeedbackDetails: #TODO Da eliminare quando si passa alla v2
      type: object
      properties:
        kind:
          type: string
          default: "SendDigitalFeedbackDetails"
        taxId:
          type: string
          description: Codice Fiscale destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        addressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        downstreamId:
          "$ref": "#/components/schemas/DownstreamId"
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
    SendPaperDetails:
      type: object
      properties:
        kind:
          type: string
          default: "SendPaperDetails"
        taxId: #TODO Da eliminare quando si passa alla v2
          type: string
          description: Codice Fiscale destinatario notifica digitale
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        serviceLevel:
          "$ref": "#/components/schemas/ServiceLevel"
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        investigation:
          type: boolean
          description: E' richiesta investigazione indirizzo fisico alternativo
    SendPaperFeedbackDetails:
      type: object
      properties:
        kind:
          type: string
          default: "SendPaperFeedbackDetails"
        taxId: #TODO Da eliminare quando si passa alla v2
          type: string
          description: Codice Fiscale destinatario notifica digitale
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        serviceLevel:
          "$ref": "#/components/schemas/ServiceLevel"
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        investigation:
          type: boolean
          description: E' richiesta investigazione indirizzo fisico alternativo
        newAddress:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"
        errors:
          type: array
          description: Lista errori, vuota in caso di successo
          items:
            type: string
            description: Lista errori, vuota in caso di successo
    SimpleRegisteredLetterDetails:
      type: object
      properties:
        kind:
          type: string
          default: "SimpleRegisteredLetterDetails"
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/PhysicalAddress"

    DigitalAddressSource:
      type: string
      description: sorgente indirizzo di invio della notifica
      enum:
        - PLATFORM
        - SPECIAL
        - GENERAL
    
    DigitalAddressInfo:
      type: object
      description: wrapper informazione indirizzo
      properties:
        address:
          $ref: "./schemas-addresses-v1.yaml#/components/schemas/DigitalAddress"
        source:
          $ref: '#/components/schemas/DigitalAddressSource'
        sentAttemptMade:
          type: integer
        lastAttemptDate:
          type: string
          format: date-time

    ServiceLevel:
      type: string
      description: Livello Servizio
      enum:
        - SIMPLE_REGISTERED_LETTER
        - REGISTERED_LETTER_890
          
    ResponseStatus:
      type: string
      description: stato risposta ricevuta da externalChannel
      enum:
        - OK
        - KO
    
    ContactPhase:
      type: string
      description: Fase in cui è avvenuta la richiesta
      enum:
        - CHOOSE_DELIVERY
        - SEND_ATTEMPT

    DeliveryMode:
      type: string
      description: Tipologia Domiciliazione
      enum:
        - DIGITAL
        - ANALOG